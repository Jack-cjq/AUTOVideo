import{g as W,d as X,u as Y,a as Z}from"./videoLibrary-lGvTVaWW.js";import{_ as ee,r as y,c as le,o as ae,a as v,b as d,d as a,f as n,g as i,E as c,p as oe,e as r,q as te,l as _,F as ne,i as ie,j as L,k as z,t as b,D as se}from"./index-DyjCXijH.js";const de={class:"video-library-page"},re={class:"card-header"},ue={class:"filters"},pe={class:"video-grid"},me=["onClick"],ve={key:1,class:"video-placeholder"},ce={key:2,class:"video-duration"},_e={class:"video-info"},fe=["title"],ge={class:"video-meta"},he={key:0},Ve={key:1},ye={class:"video-actions"},be={class:"pagination"},ke={__name:"VideoLibrary",setup(xe){const k=y(!1),U=y([]),u=y({platform:"",search:""}),s=y({page:1,size:24,total:0}),f=y(!1),t=y({id:null,video_name:"",video_url:"",thumbnail_url:"",platform:"",tags:"",description:""}),F=le(()=>t.value.id?"编辑视频":"上传视频"),D=l=>({douyin:"抖音",kuaishou:"快手",xiaohongshu:"小红书"})[l]||l,$=l=>{const e=Math.floor(l/60),x=l%60;return`${e}:${String(x).padStart(2,"0")}`},E=l=>l<1024?l+" B":l<1024*1024?(l/1024).toFixed(2)+" KB":l<1024*1024*1024?(l/(1024*1024)).toFixed(2)+" MB":(l/(1024*1024*1024)).toFixed(2)+" GB",p=async()=>{try{k.value=!0;const l={platform:u.value.platform||void 0,search:u.value.search||void 0,limit:s.value.size,offset:(s.value.page-1)*s.value.size},e=await W(l);e.code===200&&(U.value=e.data.videos,s.value.total=e.data.total)}catch(l){c.error("加载视频列表失败"),console.error(l)}finally{k.value=!1}},M=()=>{u.value={platform:"",search:""},p()},P=l=>{s.value.size=l,s.value.page=1,p()},R=l=>{s.value.page=l,p()},N=()=>{t.value={id:null,video_name:"",video_url:"",thumbnail_url:"",platform:"",tags:"",description:""},f.value=!0},q=l=>{},T=l=>{t.value={id:l.id,video_name:l.video_name,video_url:l.video_url,thumbnail_url:l.thumbnail_url,platform:l.platform,tags:l.tags,description:l.description},f.value=!0},j=async l=>{try{await se.confirm("确定要删除该视频吗？","提示",{type:"warning"}),(await X(l.id)).code===200&&(c.success("删除成功"),p())}catch(e){e!=="cancel"&&(c.error("删除失败"),console.error(e))}},G=async()=>{if(!t.value.video_name||!t.value.video_url){c.warning("请输入视频名称和视频URL");return}try{const l={video_name:t.value.video_name,video_url:t.value.video_url,thumbnail_url:t.value.thumbnail_url,platform:t.value.platform,tags:t.value.tags,description:t.value.description};let e;t.value.id?e=await Y(t.value.id,l):e=await Z(l),e.code===200||e.code===201?(c.success(t.value.id?"更新成功":"上传成功"),f.value=!1,p()):c.error(e.message||(t.value.id?"更新失败":"上传失败"))}catch(l){c.error(t.value.id?"更新失败":"上传失败"),console.error(l)}};return ae(()=>{p()}),(l,e)=>{const x=i("Upload"),C=i("el-icon"),m=i("el-button"),g=i("el-option"),w=i("el-select"),I=i("Search"),h=i("el-input"),K=i("el-image"),A=i("VideoPlay"),B=i("el-card"),H=i("el-pagination"),V=i("el-form-item"),J=i("el-form"),O=i("el-dialog"),Q=oe("loading");return d(),v("div",de,[a(B,{shadow:"never"},{header:n(()=>[r("div",re,[e[11]||(e[11]=r("h3",null,"云视频库",-1)),a(m,{type:"primary",onClick:N},{default:n(()=>[a(C,null,{default:n(()=>[a(x)]),_:1}),e[10]||(e[10]=_(" 上传视频 ",-1))]),_:1})])]),default:n(()=>[r("div",ue,[a(w,{modelValue:u.value.platform,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value.platform=o),placeholder:"选择平台",clearable:"",style:{width:"150px","margin-right":"10px"}},{default:n(()=>[a(g,{label:"抖音",value:"douyin"}),a(g,{label:"快手",value:"kuaishou"}),a(g,{label:"小红书",value:"xiaohongshu"})]),_:1},8,["modelValue"]),a(h,{modelValue:u.value.search,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.search=o),placeholder:"搜索视频名称",style:{width:"250px","margin-right":"10px"},clearable:""},{prefix:n(()=>[a(C,null,{default:n(()=>[a(I)]),_:1})]),_:1},8,["modelValue"]),a(m,{type:"primary",onClick:p},{default:n(()=>[...e[12]||(e[12]=[_("查询",-1)])]),_:1}),a(m,{onClick:M},{default:n(()=>[...e[13]||(e[13]=[_("重置",-1)])]),_:1})]),te((d(),v("div",pe,[(d(!0),v(ne,null,ie(U.value,o=>(d(),L(B,{key:o.id,class:"video-card",shadow:"hover"},{default:n(()=>[r("div",{class:"video-thumbnail",onClick:S=>q(o)},[o.thumbnail_url?(d(),L(K,{key:0,src:o.thumbnail_url,fit:"cover",style:{width:"100%",height:"200px"}},null,8,["src"])):(d(),v("div",ve,[a(C,{size:"48"},{default:n(()=>[a(A)]),_:1})])),o.duration?(d(),v("div",ce,b($(o.duration)),1)):z("",!0)],8,me),r("div",_e,[r("div",{class:"video-name",title:o.video_name},b(o.video_name),9,fe),r("div",ge,[o.platform?(d(),v("span",he,b(D(o.platform)),1)):z("",!0),o.video_size?(d(),v("span",Ve,b(E(o.video_size)),1)):z("",!0)]),r("div",ye,[a(m,{link:"",type:"primary",size:"small",onClick:S=>T(o)},{default:n(()=>[...e[14]||(e[14]=[_("编辑",-1)])]),_:1},8,["onClick"]),a(m,{link:"",type:"danger",size:"small",onClick:S=>j(o)},{default:n(()=>[...e[15]||(e[15]=[_("删除",-1)])]),_:1},8,["onClick"])])])]),_:2},1024))),128))])),[[Q,k.value]]),r("div",be,[a(H,{"current-page":s.value.page,"page-size":s.value.size,total:s.value.total,"page-sizes":[12,24,48,96],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1}),a(O,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=o=>f.value=o),title:F.value,width:"600px"},{footer:n(()=>[a(m,{onClick:e[8]||(e[8]=o=>f.value=!1)},{default:n(()=>[...e[16]||(e[16]=[_("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:G},{default:n(()=>[...e[17]||(e[17]=[_("确定",-1)])]),_:1})]),default:n(()=>[a(J,{model:t.value,"label-width":"120px"},{default:n(()=>[a(V,{label:"视频名称",required:""},{default:n(()=>[a(h,{modelValue:t.value.video_name,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.video_name=o),placeholder:"请输入视频名称"},null,8,["modelValue"])]),_:1}),a(V,{label:"视频URL",required:""},{default:n(()=>[a(h,{modelValue:t.value.video_url,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.video_url=o),placeholder:"请输入视频URL"},null,8,["modelValue"])]),_:1}),a(V,{label:"缩略图URL"},{default:n(()=>[a(h,{modelValue:t.value.thumbnail_url,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.thumbnail_url=o),placeholder:"请输入缩略图URL"},null,8,["modelValue"])]),_:1}),a(V,{label:"平台"},{default:n(()=>[a(w,{modelValue:t.value.platform,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.platform=o),placeholder:"请选择平台",clearable:"",style:{width:"100%"}},{default:n(()=>[a(g,{label:"抖音",value:"douyin"}),a(g,{label:"快手",value:"kuaishou"}),a(g,{label:"小红书",value:"xiaohongshu"})]),_:1},8,["modelValue"])]),_:1}),a(V,{label:"标签"},{default:n(()=>[a(h,{modelValue:t.value.tags,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.tags=o),placeholder:"请输入标签，用逗号分隔"},null,8,["modelValue"])]),_:1}),a(V,{label:"描述"},{default:n(()=>[a(h,{modelValue:t.value.description,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.description=o),type:"textarea",rows:4,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ue=ee(ke,[["__scopeId","data-v-60b26f4f"]]);export{Ue as default};
