import{g as J,d as K,u as O,c as Q}from"./merchants-DMPUAaz6.js";import{_ as W,r as f,l as X,n as Y,c as Z,b as z,e as a,w as t,f as s,E as V,s as ee,d as w,v as ae,h as d,i as te,t as M,H as le}from"./index-Cc1A4YXN.js";const oe={class:"merchants-page"},ne={class:"card-header"},se={class:"filters"},re={class:"pagination"},ue={__name:"Merchants",setup(de){const x=f(!1),C=f([]),c=f(null),p=f({search:"",status:""}),r=f({page:1,size:20,total:0}),g=f(!1),l=f({id:null,merchant_name:"",contact_person:"",contact_phone:"",contact_email:"",address:"",status:"active"}),U={merchant_name:[{required:!0,message:"请输入商家名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],contact_email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},B=X(()=>l.value.id?"编辑商家":"新建商家"),m=async()=>{try{x.value=!0;const n={search:p.value.search||void 0,status:p.value.status||void 0,limit:r.value.size,offset:(r.value.page-1)*r.value.size},e=await J(n);e.code===200&&(C.value=e.data.merchants,r.value.total=e.data.total)}catch(n){V.error("加载商家列表失败"),console.error(n)}finally{x.value=!1}},S=()=>{p.value={search:"",status:""},m()},D=n=>{r.value.size=n,r.value.page=1,m()},E=n=>{r.value.page=n,m()},N=()=>{l.value={id:null,merchant_name:"",contact_person:"",contact_phone:"",contact_email:"",address:"",status:"active"},g.value=!0,c.value&&c.value.clearValidate()},T=n=>{l.value={id:n.id,merchant_name:n.merchant_name,contact_person:n.contact_person,contact_phone:n.contact_phone,contact_email:n.contact_email,address:n.address,status:n.status},g.value=!0,c.value&&c.value.clearValidate()},P=async n=>{try{await le.confirm("确定要删除该商家吗？删除后不可恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await K(n.id)).code===200&&(V.success("删除成功"),C.value.length===1&&r.value.page>1&&r.value.page--,m())}catch(e){e!=="cancel"&&(V.error("删除失败"),console.error(e))}},$=async()=>{c.value&&await c.value.validate(async(n,e)=>{if(n)try{const _={merchant_name:l.value.merchant_name,contact_person:l.value.contact_person,contact_phone:l.value.contact_phone,contact_email:l.value.contact_email,address:l.value.address,status:l.value.status};let i;l.value.id?i=await O(l.value.id,_):i=await Q(_),i.code===200||i.code===201?(V.success(l.value.id?"更新成功":"创建成功"),g.value=!1,m()):V.error(i.message||(l.value.id?"更新失败":"创建失败"))}catch(_){V.error(_.message||(l.value.id?"更新失败":"创建失败")),console.error(_)}else console.log("error submit!",e)})};return Y(()=>{m()}),(n,e)=>{const _=s("Plus"),i=s("el-icon"),v=s("el-button"),I=s("Search"),h=s("el-input"),y=s("el-option"),k=s("el-select"),u=s("el-table-column"),R=s("el-tag"),j=s("el-table"),q=s("el-pagination"),F=s("el-card"),b=s("el-form-item"),H=s("el-form"),L=s("el-dialog"),A=ee("loading");return z(),Z("div",oe,[a(F,{shadow:"never"},{header:t(()=>[w("div",ne,[e[11]||(e[11]=w("h3",null,"商家管理",-1)),a(v,{type:"primary",onClick:N},{default:t(()=>[a(i,null,{default:t(()=>[a(_)]),_:1}),e[10]||(e[10]=d(" 新建商家 ",-1))]),_:1})])]),default:t(()=>[w("div",se,[a(h,{modelValue:p.value.search,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value.search=o),placeholder:"搜索商家名称",style:{width:"250px","margin-right":"10px"},clearable:""},{prefix:t(()=>[a(i,null,{default:t(()=>[a(I)]),_:1})]),_:1},8,["modelValue"]),a(k,{modelValue:p.value.status,"onUpdate:modelValue":e[1]||(e[1]=o=>p.value.status=o),placeholder:"选择状态",clearable:"",style:{width:"150px","margin-right":"10px"}},{default:t(()=>[a(y,{label:"启用",value:"active"}),a(y,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"]),a(v,{type:"primary",onClick:m},{default:t(()=>[...e[12]||(e[12]=[d("查询",-1)])]),_:1}),a(v,{onClick:S},{default:t(()=>[...e[13]||(e[13]=[d("重置",-1)])]),_:1})]),ae((z(),te(j,{data:C.value,stripe:"",style:{width:"100%","margin-top":"20px"}},{default:t(()=>[a(u,{prop:"id",label:"ID",width:"80"}),a(u,{prop:"merchant_name",label:"商家名称","min-width":"200"}),a(u,{prop:"contact_person",label:"联系人",width:"120"}),a(u,{prop:"contact_phone",label:"联系电话",width:"150"}),a(u,{prop:"contact_email",label:"邮箱",width:"200"}),a(u,{prop:"address",label:"地址","min-width":"200","show-overflow-tooltip":""}),a(u,{prop:"status",label:"状态",width:"100"},{default:t(({row:o})=>[a(R,{type:o.status==="active"?"success":"info"},{default:t(()=>[d(M(o.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(u,{prop:"created_at",label:"创建时间",width:"180"},{default:t(({row:o})=>[d(M(o.created_at?new Date(o.created_at).toLocaleString("zh-CN"):"-"),1)]),_:1}),a(u,{label:"操作",width:"200",fixed:"right"},{default:t(({row:o})=>[a(v,{link:"",type:"primary",size:"small",onClick:G=>T(o)},{default:t(()=>[...e[14]||(e[14]=[d("编辑",-1)])]),_:1},8,["onClick"]),a(v,{link:"",type:"danger",size:"small",onClick:G=>P(o)},{default:t(()=>[...e[15]||(e[15]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,x.value]]),w("div",re,[a(q,{"current-page":r.value.page,"page-size":r.value.size,total:r.value.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:D,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),a(L,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=o=>g.value=o),title:B.value,width:"600px"},{footer:t(()=>[a(v,{onClick:e[8]||(e[8]=o=>g.value=!1)},{default:t(()=>[...e[16]||(e[16]=[d("取消",-1)])]),_:1}),a(v,{type:"primary",onClick:$},{default:t(()=>[...e[17]||(e[17]=[d("确定",-1)])]),_:1})]),default:t(()=>[a(H,{ref_key:"formRef",ref:c,model:l.value,rules:U,"label-width":"120px"},{default:t(()=>[a(b,{label:"商家名称",prop:"merchant_name"},{default:t(()=>[a(h,{modelValue:l.value.merchant_name,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.merchant_name=o),placeholder:"请输入商家名称"},null,8,["modelValue"])]),_:1}),a(b,{label:"联系人",prop:"contact_person"},{default:t(()=>[a(h,{modelValue:l.value.contact_person,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.contact_person=o),placeholder:"请输入联系人"},null,8,["modelValue"])]),_:1}),a(b,{label:"联系电话",prop:"contact_phone"},{default:t(()=>[a(h,{modelValue:l.value.contact_phone,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.contact_phone=o),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(b,{label:"邮箱",prop:"contact_email"},{default:t(()=>[a(h,{modelValue:l.value.contact_email,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.contact_email=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(b,{label:"地址",prop:"address"},{default:t(()=>[a(h,{modelValue:l.value.address,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.address=o),type:"textarea",rows:3,placeholder:"请输入地址"},null,8,["modelValue"])]),_:1}),a(b,{label:"状态",prop:"status"},{default:t(()=>[a(k,{modelValue:l.value.status,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.status=o),placeholder:"请选择状态",style:{width:"100%"}},{default:t(()=>[a(y,{label:"启用",value:"active"}),a(y,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=W(ue,[["__scopeId","data-v-7cf79d23"]]);export{pe as default};
