import{_ as E,u as R,r as V,a as S,o as A,c as C,b as n,d as t,e as l,w as a,f as d,g as T,h as u,i as _,j as p,t as j,E as v,k as D}from"./index-Cc1A4YXN.js";const M={class:"auth-page"},O={class:"auth-card"},$={class:"mode-toggle"},z={key:2,class:"forgot-password-link"},F={class:"code-row"},G={class:"auth-footer"},H={__name:"Login",setup(J){const U=T(),k=R(),w=V(null),b=V(!1),o=S({mode:"password",loginId:"",password:"",email:"",code:""}),x={loginId:[{required:!0,message:"用户名或邮箱不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}]},r=V(0);let i=null;A(()=>{i&&(clearInterval(i),i=null)});const B=async()=>{if(!o.email){v.error("请先输入邮箱");return}try{await D.auth.sendCode(o.email),v.success("验证码已发送"),r.value=60,i=setInterval(()=>{if(r.value<=1){clearInterval(i),r.value=0;return}r.value-=1},1e3)}catch(c){v.error(c.message||"发送验证码失败")}},q=async()=>{w.value&&await w.value.validate(async c=>{if(!c)return;b.value=!0;const e=o.mode==="code"?{mode:"code",email:o.email,code:o.code}:{mode:"password",username:o.loginId,password:o.password},m=await k.login(e);b.value=!1,m.success?(await k.checkLogin(),U.replace("/")):v.error(m.message||"登录失败")})};return(c,e)=>{const m=d("el-radio-button"),L=d("el-radio-group"),f=d("el-input"),g=d("el-form-item"),y=d("router-link"),I=d("el-button"),N=d("el-form");return n(),C("div",M,[t("div",O,[e[11]||(e[11]=t("div",{class:"brand"},[t("div",{class:"brand-mark"},"AUTO"),t("div",{class:"brand-title"},"矩阵宝"),t("div",{class:"brand-subtitle"},"请先登录继续")],-1)),t("div",$,[l(L,{modelValue:o.mode,"onUpdate:modelValue":e[0]||(e[0]=s=>o.mode=s)},{default:a(()=>[l(m,{label:"password"},{default:a(()=>[...e[5]||(e[5]=[u("密码登录",-1)])]),_:1}),l(m,{label:"code"},{default:a(()=>[...e[6]||(e[6]=[u("邮箱验证码登录",-1)])]),_:1})]),_:1},8,["modelValue"])]),l(N,{ref_key:"formRef",ref:w,model:o,rules:x,"label-position":"top"},{default:a(()=>[o.mode==="password"?(n(),_(g,{key:0,label:"用户名或邮箱",prop:"loginId"},{default:a(()=>[l(f,{modelValue:o.loginId,"onUpdate:modelValue":e[1]||(e[1]=s=>o.loginId=s),placeholder:"用户名或邮箱"},null,8,["modelValue"])]),_:1})):p("",!0),o.mode==="password"?(n(),_(g,{key:1,label:"密码",prop:"password"},{default:a(()=>[l(f,{modelValue:o.password,"onUpdate:modelValue":e[2]||(e[2]=s=>o.password=s),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})):p("",!0),o.mode==="password"?(n(),C("div",z,[l(y,{to:"/reset-password"},{default:a(()=>[...e[7]||(e[7]=[u("忘记密码？",-1)])]),_:1})])):p("",!0),o.mode==="code"?(n(),_(g,{key:3,label:"邮箱",prop:"email"},{default:a(()=>[l(f,{modelValue:o.email,"onUpdate:modelValue":e[3]||(e[3]=s=>o.email=s),placeholder:"you@example.com"},null,8,["modelValue"])]),_:1})):p("",!0),o.mode==="code"?(n(),_(g,{key:4,label:"验证码",prop:"code"},{default:a(()=>[t("div",F,[l(f,{modelValue:o.code,"onUpdate:modelValue":e[4]||(e[4]=s=>o.code=s),placeholder:"6位验证码"},null,8,["modelValue"]),l(I,{disabled:r.value>0,onClick:B},{default:a(()=>[u(j(r.value>0?`重新发送 (${r.value}s)`:"发送验证码"),1)]),_:1},8,["disabled"])])]),_:1})):p("",!0),l(I,{type:"primary",class:"full-button",loading:b.value,onClick:q},{default:a(()=>[...e[8]||(e[8]=[u(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"]),t("div",G,[e[10]||(e[10]=t("span",null,"没有账号？",-1)),l(y,{to:"/register"},{default:a(()=>[...e[9]||(e[9]=[u("去注册",-1)])]),_:1})])])])}}},P=E(H,[["__scopeId","data-v-230216aa"]]);export{P as default};
