import{_ as ee,r as d,l as L,m as N,n as te,u as ae,c as x,b as m,e as t,d as n,w as l,f as i,g as le,F as oe,p as se,i as y,j as k,t as _,h as c,q as R}from"./index-Cc1A4YXN.js";import{g as ne}from"./dataCenter-CCaux0Tx.js";import{g as ie}from"./publishPlans-GE3Pv3cx.js";const ue={class:"dashboard"},re={class:"card-header"},de={class:"subtitle"},ce={class:"platform-selector"},pe={class:"filters"},me={class:"kpi-grid"},_e={class:"kpi-label"},ve={class:"kpi-value"},be={class:"content-row"},fe={class:"message-empty"},he={class:"message-empty"},ge={class:"card-header"},ye={class:"header-actions"},ke={class:"plan-name-cell"},we={__name:"Dashboard",setup(Ve){le();const f=d("douyin"),D=d(""),b=d("7"),A=d("private"),h=d("douyin"),P=d(!1),U=L(()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-parseInt(b.value)),`${C(e)}~${C(a)}`}),C=a=>{const e=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),u=String(a.getDate()).padStart(2,"0");return`${e}-${s}-${u}`},p=d([{key:"accounts",label:"授权账号",value:0,clickable:!0},{key:"videos",label:"发布视频数",value:0,clickable:!0},{key:"followers",label:"截止昨日总粉丝数",value:0,clickable:!0},{key:"playbacks",label:"播放量",value:0,clickable:!0},{key:"likes",label:"点赞数",value:0,clickable:!0},{key:"comments",label:"评论数",value:0,clickable:!0},{key:"newFollowers",label:"近7天净增粉丝数",value:0,clickable:!0},{key:"shares",label:"分享数",value:0,clickable:!0}]),$=d(0),B=d(0),g=d([]),F=L(()=>{const a=g.value;return Array.isArray(a)?a:(console.warn("publishPlans is not an array, converting to array:",a),[])}),I=async()=>{try{P.value=!0;const a=new Date,e=new Date;e.setDate(e.getDate()-parseInt(b.value));const s=await ne({platform:f.value,start_date:e.toISOString(),end_date:a.toISOString()});if(s.code===200){const u=s.data;p.value[0].value=u.authorized_accounts||0,p.value[1].value=u.published_videos||0,p.value[2].value=u.total_followers||0,p.value[3].value=u.playbacks||0,p.value[4].value=u.likes||0,p.value[5].value=u.comments||0,p.value[6].value=u.net_followers||0,p.value[7].value=u.shares||0}}catch(a){a.code!==401&&console.error("加载视频统计数据失败:",a)}finally{P.value=!1}},M=async()=>{try{const a=await ie({platform:h.value,limit:10,offset:0});if(a&&a.code===200&&a.data){let e=[];Array.isArray(a.data.plans)?e=a.data.plans:Array.isArray(a.data)?e=a.data:a.data.plans&&typeof a.data.plans=="object"&&(e=Object.values(a.data.plans)),Array.isArray(e)||(console.warn("Plans is not an array after processing:",e),e=[]),g.value=e.map(s=>({id:s.id,name:s.plan_name,thumbnail:"",videoCount:s.video_count||0,merchant:s.merchant_name||"",published:s.published_count||0,pending:s.pending_count||0,claimed:s.claimed_count||0,accountCount:s.account_count||0,distributionMode:O(s.distribution_mode),status:q(s.status),publishTime:s.publish_time?new Date(s.publish_time).toLocaleString("zh-CN"):""}))}else g.value=[]}catch(a){a.code!==401&&console.error("加载发布计划失败:",a),g.value=[]}},j=async()=>{},O=a=>({manual:"手动分发",sms:"接收短信派发",qrcode:"扫二维码派发",ai:"AI智能分发"})[a]||a,q=a=>({pending:"待发布",publishing:"发布中",completed:"发布成功",failed:"发布失败"})[a]||a,E=a=>({待发布:"warning",发布中:"info",发布成功:"success",发布失败:"danger"})[a]||"info";return N([f,b],()=>{I()}),N(h,()=>{M()}),te(async()=>{await ae().checkLogin()&&(I(),M(),j())}),(a,e)=>{const s=i("VideoPlay"),u=i("el-icon"),w=i("el-radio-button"),Y=i("el-radio-group"),G=i("Search"),H=i("el-input"),v=i("el-option"),z=i("el-select"),J=i("ArrowRight"),V=i("el-card"),T=i("el-tab-pane"),K=i("el-tabs"),Q=i("el-link"),r=i("el-table-column"),W=i("el-image"),X=i("el-tag"),S=i("el-button"),Z=i("el-table");return m(),x("div",ue,[t(V,{class:"video-data-card",shadow:"never"},{header:l(()=>[n("div",re,[n("div",null,[e[7]||(e[7]=n("h3",null,"视频数据",-1)),n("p",de,"最近统计: "+_(U.value),1)]),n("div",ce,[t(Y,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),size:"small"},{default:l(()=>[t(w,{label:"douyin"},{default:l(()=>[t(u,null,{default:l(()=>[t(s)]),_:1}),e[8]||(e[8]=c(" 抖音 ",-1))]),_:1}),t(w,{label:"kuaishou"},{default:l(()=>[t(u,null,{default:l(()=>[t(s)]),_:1}),e[9]||(e[9]=c(" 快手 ",-1))]),_:1}),t(w,{label:"xiaohongshu"},{default:l(()=>[t(u,null,{default:l(()=>[t(s)]),_:1}),e[10]||(e[10]=c(" 小红书 ",-1))]),_:1})]),_:1},8,["modelValue"])])]),n("div",pe,[t(H,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=o=>D.value=o),placeholder:"搜索账号",style:{width:"200px","margin-right":"10px"},clearable:""},{prefix:l(()=>[t(u,null,{default:l(()=>[t(G)]),_:1})]),_:1},8,["modelValue"]),t(z,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),style:{width:"120px"}},{default:l(()=>[t(v,{label:"最近7天",value:"7"}),t(v,{label:"最近30天",value:"30"}),t(v,{label:"最近90天",value:"90"})]),_:1},8,["modelValue"])])]),default:l(()=>[n("div",me,[(m(!0),x(oe,null,se(p.value,o=>(m(),x("div",{class:"kpi-item",key:o.key},[n("div",_e,_(o.label),1),n("div",ve,_(o.value),1),o.clickable?(m(),y(u,{key:0,class:"kpi-arrow"},{default:l(()=>[t(J)]),_:1})):k("",!0)]))),128))])]),_:1}),n("div",be,[t(V,{class:"message-card",shadow:"never"},{default:l(()=>[t(K,{modelValue:A.value,"onUpdate:modelValue":e[5]||(e[5]=o=>A.value=o)},{default:l(()=>[t(T,{label:"私信",name:"private"},{default:l(()=>[n("div",fe,[n("p",null,[c("共收到"+_($.value)+"条私信,",1),n("a",{href:"#",onClick:e[3]||(e[3]=R(()=>{},["prevent"]))},"去看看")])])]),_:1}),t(T,{label:"评论",name:"comment"},{default:l(()=>[n("div",he,[n("p",null,[c("共收到"+_(B.value)+"条评论,",1),n("a",{href:"#",onClick:e[4]||(e[4]=R(()=>{},["prevent"]))},"去看看")])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),t(V,{class:"publish-plan-card",shadow:"never"},{header:l(()=>[n("div",ge,[e[12]||(e[12]=n("h3",null,"最近发布计划",-1)),n("div",ye,[t(z,{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=o=>h.value=o),size:"small",style:{width:"100px","margin-right":"10px"}},{default:l(()=>[t(v,{label:"抖音",value:"douyin"}),t(v,{label:"快手",value:"kuaishou"}),t(v,{label:"小红书",value:"xiaohongshu"})]),_:1},8,["modelValue"]),t(Q,{type:"primary",underline:!1},{default:l(()=>[...e[11]||(e[11]=[c("查看全部 >",-1)])]),_:1})])])]),default:l(()=>[t(Z,{data:F.value,stripe:"",style:{width:"100%"}},{default:l(()=>[t(r,{prop:"id",label:"发布计划ID",width:"120"}),t(r,{label:"计划名称",width:"250"},{default:l(({row:o})=>[n("div",ke,[o.thumbnail?(m(),y(W,{key:0,src:o.thumbnail,style:{width:"40px",height:"40px","margin-right":"10px"},fit:"cover"},null,8,["src"])):k("",!0),n("span",null,_(o.name),1)])]),_:1}),t(r,{prop:"videoCount",label:"视频数",width:"80"}),t(r,{prop:"merchant",label:"关联商家",width:"120"}),t(r,{prop:"published",label:"发布成功",width:"100"}),t(r,{prop:"pending",label:"待发布",width:"100"}),t(r,{prop:"claimed",label:"已领取",width:"100"}),t(r,{prop:"accountCount",label:"账号数量",width:"100"}),t(r,{prop:"distributionMode",label:"分发模式",width:"140"}),t(r,{prop:"status",label:"发布状态",width:"100"},{default:l(({row:o})=>[t(X,{type:E(o.status)},{default:l(()=>[c(_(o.status),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"publishTime",label:"发布时间",width:"160"}),t(r,{label:"操作",width:"200",fixed:"right"},{default:l(({row:o})=>[t(S,{link:"",type:"primary",size:"small"},{default:l(()=>[...e[13]||(e[13]=[c("查看",-1)])]),_:1}),o.status==="待发布"?(m(),y(S,{key:0,link:"",type:"primary",size:"small"},{default:l(()=>[...e[14]||(e[14]=[c("保存发布信息",-1)])]),_:1})):k("",!0),o.status==="待发布"?(m(),y(S,{key:1,link:"",type:"primary",size:"small"},{default:l(()=>[...e[15]||(e[15]=[c("添加视频",-1)])]),_:1})):k("",!0)]),_:1})]),_:1},8,["data"])]),_:1})])}}},Ae=ee(we,[["__scopeId","data-v-08867293"]]);export{Ae as default};
