import{c as R,r as v,w as W,n as h,E as d,g as n,p as G,j as E,b as k,f as t,d as l,q as H,l as u,t as A,a as J,F as X,i as Y,D as K,_ as Z,o as ee,e as B}from"./index-BK2N8vuI.js";const le={__name:"AccountModal",props:{modelValue:Boolean},emits:["update:modelValue"],setup(q,{emit:x}){const z=q,b=x,w=R({get:()=>z.modelValue,set:e=>b("update:modelValue",e)}),r=v("list"),c=v([]),D=v([]),_=v(!1),p=v({device_id:"",account_name:"",platform:"douyin"});W(()=>z.modelValue,e=>{e&&(C(),M())});const C=async()=>{_.value=!0;try{const e=await h.accounts.list();if(e&&e.code===200){let a=[];Array.isArray(e.data)?a=e.data:e.data&&Array.isArray(e.data.accounts)?a=e.data.accounts:e.data&&typeof e.data=="object"&&(a=Object.values(e.data)),c.value=Array.isArray(a)?a:[]}else c.value=[]}catch(e){console.error("Load accounts error:",e),c.value=[],e.code!==401&&d.error(e.message||"加载账号列表失败")}finally{_.value=!1}},M=async()=>{try{const e=await h.devices.list();e.code===200&&(D.value=e.data||[])}catch(e){console.error("Load devices error:",e)}},N=async()=>{if(!p.value.device_id||!p.value.account_name){d.warning("请填写完整信息");return}try{const e=await h.accounts.create(p.value);e.code===200||e.code===201?(d.success("创建成功"),U(),C(),r.value="list"):d.error(e.message||"创建失败")}catch(e){d.error(e.message||"创建失败")}},j=async e=>{d.info("登录功能待实现")},F=async e=>{try{await K.confirm("确定要删除该账号吗？","提示",{type:"warning"});const a=await h.accounts.delete(e.id);a.code===200?(d.success("删除成功"),C()):d.error(a.message||"删除失败")}catch(a){a!=="cancel"&&d.error(a.message||"删除失败")}},U=()=>{p.value={device_id:"",account_name:"",platform:"douyin"}},i=()=>{b("update:modelValue",!1)};return(e,a)=>{const m=n("el-table-column"),y=n("el-tag"),f=n("el-button"),$=n("el-table"),S=n("el-tab-pane"),L=n("el-option"),g=n("el-select"),V=n("el-form-item"),I=n("el-input"),P=n("el-form"),O=n("el-tabs"),T=n("el-dialog"),o=G("loading");return k(),E(T,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=s=>w.value=s),title:"账号管理",width:"80%","before-close":i},{footer:t(()=>[l(f,{onClick:i},{default:t(()=>[...a[9]||(a[9]=[u("关闭",-1)])]),_:1}),l(f,{type:"primary",onClick:C,loading:_.value},{default:t(()=>[...a[10]||(a[10]=[u("刷新",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(O,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=s=>r.value=s)},{default:t(()=>[l(S,{label:"账号列表",name:"list"},{default:t(()=>[H((k(),E($,{data:e.safeAccounts,style:{width:"100%"},stripe:""},{default:t(()=>[l(m,{prop:"account_name",label:"账号名称"}),l(m,{prop:"platform",label:"平台"}),l(m,{prop:"login_status",label:"登录状态",width:"120"},{default:t(({row:s})=>[l(y,{type:s.login_status==="logged_in"?"success":"info"},{default:t(()=>[u(A(s.login_status==="logged_in"?"已登录":"未登录"),1)]),_:2},1032,["type"])]),_:1}),l(m,{label:"操作",width:"200"},{default:t(({row:s})=>[l(f,{size:"small",onClick:Q=>j(s)},{default:t(()=>[...a[5]||(a[5]=[u("登录",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:Q=>F(s)},{default:t(()=>[...a[6]||(a[6]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[o,_.value]])]),_:1}),l(S,{label:"添加账号",name:"add"},{default:t(()=>[l(P,{model:p.value,"label-width":"120px"},{default:t(()=>[l(V,{label:"设备ID"},{default:t(()=>[l(g,{modelValue:p.value.device_id,"onUpdate:modelValue":a[0]||(a[0]=s=>p.value.device_id=s),placeholder:"请选择设备"},{default:t(()=>[(k(!0),J(X,null,Y(D.value,s=>(k(),E(L,{key:s.device_id,label:`${s.device_name} (${s.device_id})`,value:s.device_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"账号名称"},{default:t(()=>[l(I,{modelValue:p.value.account_name,"onUpdate:modelValue":a[1]||(a[1]=s=>p.value.account_name=s),placeholder:"请输入账号名称"},null,8,["modelValue"])]),_:1}),l(V,{label:"平台"},{default:t(()=>[l(g,{modelValue:p.value.platform,"onUpdate:modelValue":a[2]||(a[2]=s=>p.value.platform=s),placeholder:"请选择平台"},{default:t(()=>[l(L,{label:"抖音",value:"douyin"})]),_:1},8,["modelValue"])]),_:1}),l(V,null,{default:t(()=>[l(f,{type:"primary",onClick:N},{default:t(()=>[...a[7]||(a[7]=[u("创建",-1)])]),_:1}),l(f,{onClick:U},{default:t(()=>[...a[8]||(a[8]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}},ae={class:"accounts-page"},te={class:"card-header"},oe={class:"filters"},ne={class:"pagination"},se={__name:"Accounts",setup(q){const x=v(!1),z=v([]),b=v(!1),w=v(null),r=v({platform:"",login_status:"",search:""}),c=v({page:1,size:20,total:0}),D=i=>({douyin:"抖音",kuaishou:"快手",xiaohongshu:"小红书"})[i]||i,_=async()=>{var i,e;try{x.value=!0;const a={platform:r.value.platform||void 0,login_status:r.value.login_status||void 0,search:r.value.search||void 0,limit:c.value.size,offset:(c.value.page-1)*c.value.size},m=await h.accounts.list(a);m.code===200?(z.value=((i=m.data)==null?void 0:i.accounts)||[],c.value.total=((e=m.data)==null?void 0:e.total)||0):d.error(m.message||"加载账号列表失败")}catch(a){d.error(a.message||"加载账号列表失败"),console.error(a)}finally{x.value=!1}},p=()=>{r.value={platform:"",login_status:"",search:""},_()},C=i=>{c.value.size=i,c.value.page=1,_()},M=i=>{c.value.page=i,_()},N=()=>{w.value=null,b.value=!0},j=i=>{w.value=i,b.value=!0},F=async i=>{try{const e=await h.login.start({account_id:i.id});if(e.code===200&&e.data){const a=e.data.login_url||`/login-helper?account_id=${i.id}`;window.open(a,"_blank","width=1000,height=800"),d.success("已打开登录助手页面，请在新窗口中完成登录")}else d.error(e.message||"打开登录助手页面失败")}catch(e){console.error("登录失败:",e),d.error(e.message||"打开登录助手页面失败")}},U=async i=>{try{await K.confirm("确定要删除该账号吗？","提示",{type:"warning"});const e=await h.accounts.delete(i.id);e.code===200?(d.success("删除成功"),_()):d.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(d.error(e.message||"删除失败"),console.error(e))}};return ee(()=>{_()}),(i,e)=>{const a=n("Plus"),m=n("el-icon"),y=n("el-button"),f=n("el-option"),$=n("el-select"),S=n("Search"),L=n("el-input"),g=n("el-table-column"),V=n("el-tag"),I=n("el-table"),P=n("el-pagination"),O=n("el-card"),T=G("loading");return k(),J("div",ae,[l(O,{shadow:"never"},{header:t(()=>[B("div",te,[e[5]||(e[5]=B("h3",null,"授权管理",-1)),l(y,{type:"primary",onClick:N},{default:t(()=>[l(m,null,{default:t(()=>[l(a)]),_:1}),e[4]||(e[4]=u(" 添加账号 ",-1))]),_:1})])]),default:t(()=>[B("div",oe,[l($,{modelValue:r.value.platform,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.platform=o),placeholder:"选择平台",clearable:"",style:{width:"150px","margin-right":"10px"}},{default:t(()=>[l(f,{label:"抖音",value:"douyin"}),l(f,{label:"快手",value:"kuaishou"}),l(f,{label:"小红书",value:"xiaohongshu"})]),_:1},8,["modelValue"]),l($,{modelValue:r.value.login_status,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.login_status=o),placeholder:"登录状态",clearable:"",style:{width:"150px","margin-right":"10px"}},{default:t(()=>[l(f,{label:"已登录",value:"logged_in"}),l(f,{label:"未登录",value:"logged_out"})]),_:1},8,["modelValue"]),l(L,{modelValue:r.value.search,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.search=o),placeholder:"搜索账号名称",style:{width:"250px","margin-right":"10px"},clearable:""},{prefix:t(()=>[l(m,null,{default:t(()=>[l(S)]),_:1})]),_:1},8,["modelValue"]),l(y,{type:"primary",onClick:_},{default:t(()=>[...e[6]||(e[6]=[u("查询",-1)])]),_:1}),l(y,{onClick:p},{default:t(()=>[...e[7]||(e[7]=[u("重置",-1)])]),_:1})]),H((k(),E(I,{data:z.value,stripe:"",style:{width:"100%","margin-top":"20px"}},{default:t(()=>[l(g,{prop:"id",label:"ID",width:"80"}),l(g,{prop:"account_name",label:"账号名称","min-width":"200"}),l(g,{prop:"platform",label:"平台",width:"100"},{default:t(({row:o})=>[l(V,null,{default:t(()=>[u(A(D(o.platform)),1)]),_:2},1024)]),_:1}),l(g,{prop:"device_id",label:"设备ID",width:"120"}),l(g,{prop:"login_status",label:"登录状态",width:"120"},{default:t(({row:o})=>[l(V,{type:o.login_status==="logged_in"?"success":"info"},{default:t(()=>[u(A(o.login_status==="logged_in"?"已登录":"未登录"),1)]),_:2},1032,["type"])]),_:1}),l(g,{prop:"last_login_time",label:"最后登录时间",width:"180"},{default:t(({row:o})=>[u(A(o.last_login_time?new Date(o.last_login_time).toLocaleString("zh-CN"):"-"),1)]),_:1}),l(g,{prop:"created_at",label:"创建时间",width:"180"},{default:t(({row:o})=>[u(A(o.created_at?new Date(o.created_at).toLocaleString("zh-CN"):"-"),1)]),_:1}),l(g,{label:"操作",width:"250",fixed:"right"},{default:t(({row:o})=>[l(y,{link:"",type:"primary",size:"small",onClick:s=>F(o)},{default:t(()=>[...e[8]||(e[8]=[u("登录",-1)])]),_:1},8,["onClick"]),l(y,{link:"",type:"primary",size:"small",onClick:s=>j(o)},{default:t(()=>[...e[9]||(e[9]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(y,{link:"",type:"danger",size:"small",onClick:s=>U(o)},{default:t(()=>[...e[10]||(e[10]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,x.value]]),B("div",ne,[l(P,{"current-page":c.value.page,"page-size":c.value.size,total:c.value.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:C,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1}),l(le,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=o=>b.value=o),account:w.value,onSuccess:_},null,8,["modelValue","account"])])}}},ue=Z(se,[["__scopeId","data-v-3da9f3d9"]]);export{ue as default};
