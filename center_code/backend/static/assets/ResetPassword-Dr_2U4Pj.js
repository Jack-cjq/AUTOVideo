import{_ as $,r as v,a as h,o as q,c as A,b as w,d as r,e as a,i as R,j as E,w as s,f as n,g as z,h as g,t as S,E as d,k as x}from"./index-Cc1A4YXN.js";const T={class:"auth-page"},Z={class:"auth-card"},j={class:"code-row"},D={class:"auth-footer"},M={__name:"ResetPassword",setup(O){const C=z(),p=v(null),u=v(!1),i=v(0),l=h({email:"",code:"",password:""}),U={email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}]},B={code:[{required:!0,message:"验证码不能为空",trigger:"blur"},{min:6,max:6,message:"验证码必须是6位",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{min:8,message:"密码至少8个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/,message:"密码必须包含大小写字母、数字和特殊字符",trigger:"blur"}]},t=v(0);let m=null;q(()=>{m&&(clearInterval(m),m=null)});const y=async()=>{if(!l.email){d.error("请先输入邮箱");return}u.value=!0;try{await x.auth.forgotPassword({email:l.email}),d.success("验证码已发送，请查收邮箱"),t.value=60,m=setInterval(()=>{if(t.value<=1){clearInterval(m),t.value=0;return}t.value-=1},1e3),i.value===0&&(i.value=1)}catch(c){d.error(c.message||"发送验证码失败")}finally{u.value=!1}},P=async()=>{p.value&&await p.value.validate(async c=>{if(c){u.value=!0;try{const e=await x.auth.resetPassword({email:l.email,code:l.code,password:l.password});e.code===200?(d.success("密码重置成功，请使用新密码登录"),C.push("/login")):d.error(e.message||"密码重置失败")}catch(e){d.error(e.message||"密码重置失败")}finally{u.value=!1}}})};return(c,e)=>{const V=n("el-step"),I=n("el-steps"),f=n("el-input"),_=n("el-form-item"),b=n("el-button"),k=n("el-form"),N=n("router-link");return w(),A("div",T,[r("div",Z,[e[7]||(e[7]=r("div",{class:"brand"},[r("div",{class:"brand-mark"},"AUTO"),r("div",{class:"brand-title"},"矩阵宝"),r("div",{class:"brand-subtitle"},"重置您的密码")],-1)),a(I,{active:i.value,class:"reset-steps"},{default:s(()=>[a(V,{title:"验证邮箱"}),a(V,{title:"设置新密码"})]),_:1},8,["active"]),i.value===0?(w(),R(k,{key:0,ref_key:"formRef",ref:p,model:l,rules:U,"label-position":"top"},{default:s(()=>[a(_,{label:"邮箱",prop:"email"},{default:s(()=>[a(f,{modelValue:l.email,"onUpdate:modelValue":e[0]||(e[0]=o=>l.email=o),placeholder:"you@example.com"},null,8,["modelValue"])]),_:1}),a(b,{type:"primary",class:"full-button",loading:u.value,onClick:y},{default:s(()=>[...e[4]||(e[4]=[g(" 发送验证码 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])):i.value===1?(w(),R(k,{key:1,ref_key:"formRef",ref:p,model:l,rules:B,"label-position":"top"},{default:s(()=>[a(_,{label:"邮箱",prop:"email"},{default:s(()=>[a(f,{modelValue:l.email,"onUpdate:modelValue":e[1]||(e[1]=o=>l.email=o),disabled:""},null,8,["modelValue"])]),_:1}),a(_,{label:"验证码",prop:"code"},{default:s(()=>[r("div",j,[a(f,{modelValue:l.code,"onUpdate:modelValue":e[2]||(e[2]=o=>l.code=o),placeholder:"6位验证码"},null,8,["modelValue"]),a(b,{disabled:t.value>0,onClick:y},{default:s(()=>[g(S(t.value>0?`重新发送 (${t.value}s)`:"发送验证码"),1)]),_:1},8,["disabled"])])]),_:1}),a(_,{label:"新密码",prop:"password"},{default:s(()=>[a(f,{modelValue:l.password,"onUpdate:modelValue":e[3]||(e[3]=o=>l.password=o),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(b,{type:"primary",class:"full-button",loading:u.value,onClick:P},{default:s(()=>[...e[5]||(e[5]=[g(" 重置密码 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])):E("",!0),r("div",D,[a(N,{to:"/login"},{default:s(()=>[...e[6]||(e[6]=[g("返回登录",-1)])]),_:1})])])])}}},G=$(M,[["__scopeId","data-v-271ae209"]]);export{G as default};
