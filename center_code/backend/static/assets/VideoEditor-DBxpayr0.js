import{G as x,_ as $e,u as Ae,r as m,c as B,o as Me,a as y,b as r,d as t,f as l,g as i,E as u,p as Se,q as G,k,j as z,F as J,i as K,e as n,t as h,m as Q,l as d,H as Ie,D as R}from"./index-DyjCXijH.js";const De=c=>x.get("/video-editor/projects",{params:c}),Ee=c=>x.get(`/video-editor/projects/${c}`),je=c=>x.post("/video-editor/projects",c),Be=(c,P)=>x.put(`/video-editor/projects/${c}`,P),Le=c=>x.delete(`/video-editor/projects/${c}`),Ne=(c,P)=>x.post(`/video-editor/projects/${c}/export`,P),Te={class:"video-editor-page"},qe={class:"card-header"},Fe={class:"project-list"},He={class:"project-header"},Oe={class:"project-actions"},Ge={class:"project-info"},Je={class:"info-item"},Ke={class:"info-item"},Qe={key:0,class:"info-item"},Re={key:0,class:"pagination"},We={key:0,class:"workspace"},Xe={class:"workspace-header"},Ye={class:"workspace-actions"},Ze={class:"workspace-content"},et={class:"workspace-left"},tt={class:"video-materials"},lt=["onClick"],ot={class:"duration"},at={class:"workspace-center"},st={class:"preview-area"},nt={class:"preview-placeholder"},it={class:"workspace-right"},dt={class:"timeline-area"},ut={class:"timeline-placeholder"},rt={class:"ai-features"},pt={__name:"VideoEditor",setup(c){const P=Ae(),V=m(!1),b=m(!1),I=m([]),U=m(null),L=m(null),W=m({search:""}),v=m({page:1,size:12,total:0}),w=m(!1),S=m(!1),s=m({id:null,name:"",description:"",edit_mode:"auto",target_duration:60,keep_highlights:!0,auto_subtitle:!0,music_style:"",transition:"fade"}),D=m([]),X=B(()=>s.value.id?"编辑项目":"新建项目"),Y=B(()=>"/api/video-editor/upload"),Z=B(()=>({Authorization:`Bearer ${P.token||""}`})),ee=o=>o?new Date(o).toLocaleString("zh-CN"):"-",te=o=>{if(!o)return"0:00";const e=Math.floor(o/60),A=Math.floor(o%60);return`${e}:${String(A).padStart(2,"0")}`},le=o=>({pending:"待处理",processing:"处理中",completed:"已完成",failed:"失败"})[o]||o,$=async()=>{try{V.value=!0;const o={search:W.value.search||void 0,limit:v.value.size,offset:(v.value.page-1)*v.value.size},e=await De(o);e.code===200&&(I.value=e.data.projects||[],v.value.total=e.data.total||0)}catch(o){u.error("加载项目列表失败"),console.error(o)}finally{V.value=!1}},oe=o=>{v.value.size=o,v.value.page=1,$()},ae=o=>{v.value.page=o,$()},se=()=>{s.value={id:null,name:"",description:"",edit_mode:"auto",target_duration:60,keep_highlights:!0,auto_subtitle:!0,music_style:"",transition:"fade"},D.value=[],w.value=!0},ne=o=>{s.value={id:o.id,name:o.name,description:o.description||"",edit_mode:o.edit_mode||"auto",target_duration:o.target_duration||60,keep_highlights:o.keep_highlights!==!1,auto_subtitle:o.auto_subtitle!==!1,music_style:o.music_style||"",transition:o.transition||"fade"},D.value=[],w.value=!0},ie=async o=>{try{await R.confirm("确定要删除该项目吗？删除后无法恢复。","提示",{type:"warning"}),(await Le(o.id)).code===200&&(u.success("删除成功"),$())}catch(e){e!=="cancel"&&(u.error("删除失败"),console.error(e))}},de=async o=>{try{V.value=!0;const e=await Ee(o.id);e.code===200&&(U.value=e.data,S.value=!0)}catch(e){u.error("打开项目失败"),console.error(e)}finally{V.value=!1}},ue=o=>{const e=["video/mp4","video/avi","video/mov","video/quicktime"].includes(o.type),A=o.size/1024/1024<500;return e?A?!0:(u.error("视频文件大小不能超过 500MB!"),!1):(u.error("只能上传视频文件!"),!1)},re=(o,e)=>{u.success("视频上传成功")},pe=o=>{u.error("视频上传失败"),console.error(o)},ce=async()=>{if(!s.value.name){u.warning("请输入项目名称");return}try{b.value=!0;const o={name:s.value.name,description:s.value.description,edit_mode:s.value.edit_mode,target_duration:s.value.target_duration,keep_highlights:s.value.keep_highlights,auto_subtitle:s.value.auto_subtitle,music_style:s.value.music_style,transition:s.value.transition};let e;s.value.id?e=await Be(s.value.id,o):e=await je(o),(e.code===200||e.code===201)&&(u.success(s.value.id?"更新成功":"创建成功"),w.value=!1,$())}catch(o){u.error(s.value.id?"更新失败":"创建失败"),console.error(o)}finally{b.value=!1}},ve=o=>{L.value=o},me=()=>{u.info("预览功能待实现")},_e=async()=>{try{await R.confirm("确定要导出视频吗？","提示",{type:"info"}),b.value=!0;const o=await Ne(U.value.id);(o.code===200||o.code===201)&&u.success("导出任务已提交，请稍后查看")}catch(o){o!=="cancel"&&(u.error("导出失败"),console.error(o))}finally{b.value=!1}},fe=()=>{u.info("智能裁剪功能待实现")},ge=()=>{u.info("生成字幕功能待实现")},ye=()=>{u.info("滤镜美化功能待实现")},ke=()=>{u.info("配乐推荐功能待实现")};return Me(()=>{$()}),(o,e)=>{const A=i("Plus"),g=i("el-icon"),p=i("el-button"),he=i("el-empty"),E=i("VideoPlay"),N=i("Clock"),Ve=i("Loading"),C=i("el-card"),be=i("el-pagination"),T=i("el-input"),_=i("el-form-item"),we=i("Upload"),Ce=i("el-upload"),ze=i("el-divider"),j=i("el-radio"),xe=i("el-radio-group"),Pe=i("el-input-number"),q=i("el-switch"),f=i("el-option"),F=i("el-select"),Ue=i("el-form"),H=i("el-dialog"),O=Se("loading");return r(),y("div",Te,[t(C,{shadow:"never"},{header:l(()=>[n("div",qe,[e[13]||(e[13]=n("h3",null,"AI视频剪辑",-1)),t(p,{type:"primary",onClick:se},{default:l(()=>[t(g,null,{default:l(()=>[t(A)]),_:1}),e[12]||(e[12]=d(" 新建项目 ",-1))]),_:1})])]),default:l(()=>[G((r(),y("div",Fe,[I.value.length===0&&!V.value?(r(),z(he,{key:0,description:"暂无项目，点击新建项目开始剪辑"})):k("",!0),(r(!0),y(J,null,K(I.value,a=>(r(),z(C,{key:a.id,class:"project-card",shadow:"hover",onClick:M=>de(a)},{default:l(()=>[n("div",He,[n("h4",null,h(a.name),1),n("div",Oe,[t(p,{link:"",type:"primary",size:"small",onClick:Q(M=>ne(a),["stop"])},{default:l(()=>[...e[14]||(e[14]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(p,{link:"",type:"danger",size:"small",onClick:Q(M=>ie(a),["stop"])},{default:l(()=>[...e[15]||(e[15]=[d("删除",-1)])]),_:1},8,["onClick"])])]),n("div",Ge,[n("div",Je,[t(g,null,{default:l(()=>[t(E)]),_:1}),n("span",null,"视频数量: "+h(a.video_count||0),1)]),n("div",Ke,[t(g,null,{default:l(()=>[t(N)]),_:1}),n("span",null,"创建时间: "+h(ee(a.created_at)),1)]),a.status?(r(),y("div",Qe,[t(g,null,{default:l(()=>[t(Ve)]),_:1}),n("span",null,"状态: "+h(le(a.status)),1)])):k("",!0)])]),_:2},1032,["onClick"]))),128))])),[[O,V.value]]),v.value.total>0?(r(),y("div",Re,[t(be,{"current-page":v.value.page,"page-size":v.value.size,total:v.value.total,"page-sizes":[12,24,48],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:ae},null,8,["current-page","page-size","total"])])):k("",!0)]),_:1}),t(H,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=a=>w.value=a),title:X.value,width:"800px"},{footer:l(()=>[t(p,{onClick:e[8]||(e[8]=a=>w.value=!1)},{default:l(()=>[...e[23]||(e[23]=[d("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:ce,loading:b.value},{default:l(()=>[...e[24]||(e[24]=[d("确定",-1)])]),_:1},8,["loading"])]),default:l(()=>[G((r(),z(Ue,{model:s.value,"label-width":"120px"},{default:l(()=>[t(_,{label:"项目名称",required:""},{default:l(()=>[t(T,{modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.name=a),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),t(_,{label:"项目描述"},{default:l(()=>[t(T,{modelValue:s.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.description=a),type:"textarea",rows:3,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),t(_,{label:"上传视频"},{default:l(()=>[t(Ce,{class:"video-uploader",action:Y.value,headers:Z.value,"on-success":re,"on-error":pe,"before-upload":ue,"file-list":D.value,multiple:"",accept:"video/*"},{tip:l(()=>[...e[17]||(e[17]=[n("div",{class:"el-upload__tip"}," 支持 MP4、AVI、MOV 等格式，单个文件不超过 500MB ",-1)])]),default:l(()=>[t(p,{type:"primary"},{default:l(()=>[t(g,null,{default:l(()=>[t(we)]),_:1}),e[16]||(e[16]=d(" 选择视频文件 ",-1))]),_:1})]),_:1},8,["action","headers","file-list"])]),_:1}),t(ze,null,{default:l(()=>[...e[18]||(e[18]=[d("AI剪辑参数",-1)])]),_:1}),t(_,{label:"剪辑模式"},{default:l(()=>[t(xe,{modelValue:s.value.edit_mode,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.edit_mode=a)},{default:l(()=>[t(j,{label:"auto"},{default:l(()=>[...e[19]||(e[19]=[d("自动剪辑",-1)])]),_:1}),t(j,{label:"smart"},{default:l(()=>[...e[20]||(e[20]=[d("智能剪辑",-1)])]),_:1}),t(j,{label:"custom"},{default:l(()=>[...e[21]||(e[21]=[d("自定义",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s.value.edit_mode!=="custom"?(r(),z(_,{key:0,label:"目标时长"},{default:l(()=>[t(Pe,{modelValue:s.value.target_duration,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.target_duration=a),min:10,max:600,step:10,style:{width:"200px"}},null,8,["modelValue"]),e[22]||(e[22]=n("span",{style:{"margin-left":"10px"}},"秒",-1))]),_:1})):k("",!0),t(_,{label:"保留精彩片段"},{default:l(()=>[t(q,{modelValue:s.value.keep_highlights,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.keep_highlights=a)},null,8,["modelValue"])]),_:1}),t(_,{label:"自动添加字幕"},{default:l(()=>[t(q,{modelValue:s.value.auto_subtitle,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.auto_subtitle=a)},null,8,["modelValue"])]),_:1}),s.value.edit_mode!=="custom"?(r(),z(_,{key:1,label:"背景音乐"},{default:l(()=>[t(F,{modelValue:s.value.music_style,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.music_style=a),placeholder:"选择音乐风格",clearable:"",style:{width:"100%"}},{default:l(()=>[t(f,{label:"无音乐",value:"none"}),t(f,{label:"轻快",value:"light"}),t(f,{label:"激昂",value:"energetic"}),t(f,{label:"舒缓",value:"relaxing"}),t(f,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1})):k("",!0),s.value.edit_mode!=="custom"?(r(),z(_,{key:2,label:"转场效果"},{default:l(()=>[t(F,{modelValue:s.value.transition,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.transition=a),placeholder:"选择转场效果",clearable:"",style:{width:"100%"}},{default:l(()=>[t(f,{label:"无转场",value:"none"}),t(f,{label:"淡入淡出",value:"fade"}),t(f,{label:"滑动",value:"slide"}),t(f,{label:"缩放",value:"zoom"})]),_:1},8,["modelValue"])]),_:1})):k("",!0)]),_:1},8,["model"])),[[O,b.value]])]),_:1},8,["modelValue","title"]),t(H,{modelValue:S.value,"onUpdate:modelValue":e[11]||(e[11]=a=>S.value=a),title:"AI视频剪辑工作台",width:"90%","close-on-click-modal":!1,fullscreen:""},{default:l(()=>[U.value?(r(),y("div",We,[n("div",Xe,[n("h3",null,h(U.value.name),1),n("div",Ye,[t(p,{onClick:me},{default:l(()=>[...e[25]||(e[25]=[d("预览",-1)])]),_:1}),t(p,{type:"primary",onClick:_e},{default:l(()=>[...e[26]||(e[26]=[d("导出视频",-1)])]),_:1}),t(p,{onClick:e[10]||(e[10]=a=>S.value=!1)},{default:l(()=>[...e[27]||(e[27]=[d("关闭",-1)])]),_:1})])]),n("div",Ze,[n("div",et,[t(C,{shadow:"never"},{header:l(()=>[...e[28]||(e[28]=[d("视频素材",-1)])]),default:l(()=>[n("div",tt,[(r(!0),y(J,null,K(U.value.videos,a=>{var M;return r(),y("div",{key:a.id,class:Ie(["material-item",{active:((M=L.value)==null?void 0:M.id)===a.id}]),onClick:ct=>ve(a)},[t(g,null,{default:l(()=>[t(E)]),_:1}),n("span",null,h(a.name),1),n("span",ot,h(te(a.duration)),1)],10,lt)}),128))])]),_:1})]),n("div",at,[t(C,{shadow:"never"},{header:l(()=>[...e[29]||(e[29]=[d("预览窗口",-1)])]),default:l(()=>[n("div",st,[n("div",nt,[t(g,{size:"64"},{default:l(()=>[t(E)]),_:1}),e[30]||(e[30]=n("p",null,"视频预览区域",-1))])])]),_:1})]),n("div",it,[t(C,{shadow:"never"},{header:l(()=>[...e[31]||(e[31]=[d("时间轴",-1)])]),default:l(()=>[n("div",dt,[n("div",ut,[t(g,{size:"64"},{default:l(()=>[t(N)]),_:1}),e[32]||(e[32]=n("p",null,"时间轴编辑区域",-1))])])]),_:1}),t(C,{shadow:"never",style:{"margin-top":"20px"}},{header:l(()=>[...e[33]||(e[33]=[d("AI功能",-1)])]),default:l(()=>[n("div",rt,[t(p,{onClick:fe},{default:l(()=>[...e[34]||(e[34]=[d("智能裁剪",-1)])]),_:1}),t(p,{onClick:ge},{default:l(()=>[...e[35]||(e[35]=[d("生成字幕",-1)])]),_:1}),t(p,{onClick:ye},{default:l(()=>[...e[36]||(e[36]=[d("滤镜美化",-1)])]),_:1}),t(p,{onClick:ke},{default:l(()=>[...e[37]||(e[37]=[d("配乐推荐",-1)])]),_:1})])]),_:1})])])])):k("",!0)]),_:1},8,["modelValue"])])}}},mt=$e(pt,[["__scopeId","data-v-cc601399"]]);export{mt as default};
