import{_ as ol,r as y,w as nl,c as q,o as il,a as _,b as u,d as t,f as o,g as v,n as W,E as d,p as sl,q as D,e as p,j as b,l as s,t as m,k as c,v as B,s as E,x as de,y as rl,z as ul,F as H,i as I,A as dl,B as pl,C as vl,D as pe}from"./index-DyjCXijH.js";import{g as _l}from"./videoLibrary-lGvTVaWW.js";const cl={class:"publish-page"},ml={class:"card-header"},gl={class:"history-section"},fl={key:0,style:{color:"#f56c6c"}},yl={key:1},bl={class:"pagination-wrapper"},hl={class:"step-content"},xl={key:0,style:{"margin-top":"20px"}},kl={key:0,style:{"margin-top":"10px"}},wl={class:"video-preview"},Vl=["src"],Cl={key:1,class:"preview-placeholder"},Ul={key:1,style:{"margin-top":"20px"}},zl={style:{display:"flex","align-items":"center"}},Al={class:"step-content"},Sl={style:{"margin-bottom":"10px"}},$l={key:0},El={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Tl={style:{display:"flex","align-items":"center",gap:"8px"}},Dl={style:{display:"flex","align-items":"center",gap:"8px"}},Ll={key:0,style:{"margin-top":"10px"}},Ml={key:0,class:"selected-accounts"},Rl={class:"step-content"},Pl={key:0,class:"tags-display",style:{"margin-top":"10px"}},Nl={key:1,style:{"margin-top":"5px"}},Bl={style:{display:"flex","flex-direction":"column",gap:"10px"}},Hl={key:0,class:"thumbnail-preview",style:{"margin-top":"10px"}},Il={class:"step-content"},Ol={key:0,style:{"margin-left":"10px"}},jl={class:"form-actions"},ql={__name:"Publish",setup(Wl){const a=y({video_id:null,video_url:"",video_title:"",video_description:"",video_tags_array:[],thumbnail_url:"",account_ids:[],publish_date:"",priority:"normal",after_publish_actions:[],retry_on_failure:!1,retry_count:3}),k=y([]),x=y([]),F=y([]),Y=y(!1),g=y(0),V=y("upload"),z=y([]),C=y("immediate"),O=y(30),A=y(!1);nl(A,l=>{l&&S.value.length===0&&M()});const K=y(!1),S=y([]),ve=q(()=>{const l=S.value;return Array.isArray(l)?l:(console.warn("publishHistory is not an array, converting to array:",l),[])}),w=y({page:1,size:10,total:0}),_e=y(["搞笑","美食","旅游","音乐","舞蹈","宠物","科技","时尚","健身","教育","生活","情感","游戏","影视","汽车","房产","财经","健康","母婴","美妆"]),ce=q(()=>"/api/publish/upload-video"),me=q(()=>"/api/publish/upload-thumbnail"),le=q(()=>({})),L=l=>({douyin:"抖音",kuaishou:"快手",xiaohongshu:"小红书"})[l]||l,ge=l=>({pending:"info",uploading:"warning",completed:"success",failed:"danger"})[l]||"info",te=l=>({pending:"待发布",uploading:"发布中",completed:"已完成",failed:"失败"})[l]||l,fe=l=>{const e=k.value.find(i=>i.id===l);return e?`${e.account_name} (${L(e.platform)})`:""},ye=async()=>{try{const l=await W.accounts.list({limit:1e3});if(console.log("账号列表响应:",l),l&&l.code===200){let e=[];l.data?Array.isArray(l.data.accounts)?e=l.data.accounts:Array.isArray(l.data)&&(e=l.data):Array.isArray(l)&&(e=l),k.value=e.filter(i=>i.login_status==="logged_in"),J(),console.log("加载的账号数量:",k.value.length),console.log("账号列表:",k.value)}else console.warn("账号列表响应格式不正确:",l),k.value=[],x.value=[]}catch(l){console.error("加载账号列表失败:",l),k.value=[],x.value=[],l.code!==401&&d.error("加载账号列表失败: "+(l.message||"未知错误"))}},ae=async()=>{try{const l=await _l({limit:100});l.code===200&&(F.value=l.data.videos||[])}catch(l){console.error("加载视频库失败:",l)}},M=async()=>{var l,e;try{K.value=!0;const i=await W.post("/publish/history",{page:w.value.page,size:w.value.size});if(console.log("发布历史响应:",i),i&&i.code===200){const r=((l=i.data)==null?void 0:l.list)||[];S.value=Array.isArray(r)?r:[],w.value.total=((e=i.data)==null?void 0:e.total)||0,console.log("加载的发布历史数量:",S.value.length),console.log("发布历史数据:",S.value)}else console.error("加载发布历史失败:",(i==null?void 0:i.message)||"未知错误"),S.value=[],w.value.total=0}catch(i){console.error("加载发布历史失败:",i),S.value=[],w.value.total=0,i.code!==401&&d.error("加载发布历史失败: "+(i.message||"未知错误"))}finally{K.value=!1}},G=l=>k.value.filter(e=>e.platform===l).length,be=l=>({douyin:"danger",kuaishou:"warning",xiaohongshu:"warning"})[l]||"info",J=()=>{z.value.length===0?x.value=k.value.filter(e=>e.login_status==="logged_in"):x.value=k.value.filter(e=>z.value.includes(e.platform)&&e.login_status==="logged_in");const l=x.value.map(e=>e.id);a.value.account_ids=a.value.account_ids.filter(e=>l.includes(e)||k.value.find(i=>i.id===e))},he=()=>{const l=x.value.filter(r=>r.login_status==="logged_in");if(l.length===0){d.warning("当前筛选条件下没有可用的已登录账号");return}const e=l.map(r=>r.id),i=a.value.account_ids||[];a.value.account_ids=[...new Set([...i,...e])],d.success(`已选择 ${e.length} 个账号`)},xe=()=>{a.value.account_ids.length!==0&&(a.value.account_ids=[],d.info("已清空所有选择"))},ke=()=>{z.value=[],J(),d.info("已清除平台筛选")},we=l=>{const e=l.filter(i=>{const r=k.value.find(h=>h.id===i);return r&&r.login_status!=="logged_in"});e.length>0&&(d.warning("只能选择已登录的账号"),a.value.account_ids=l.filter(i=>!e.includes(i)))},Ve=l=>{const e=a.value.account_ids.indexOf(l);e>-1&&a.value.account_ids.splice(e,1)},Ce=l=>{a.value.video_tags_array.splice(l,1)},Ue=l=>{l&&l.length>10&&(a.value.video_tags_array=l.slice(0,10),d.warning("最多只能添加10个标签")),l&&l.length>0&&(a.value.video_tags_array=[...new Set(l)])},ze=()=>{V.value==="library"?ae():V.value==="upload"&&(a.value.video_url="",a.value.video_id=null)},Ae=l=>{const e=F.value.find(i=>i.id===l);e&&(a.value.video_url=e.video_url,a.value.video_title=e.video_name||a.value.video_title,a.value.thumbnail_url=e.thumbnail_url||a.value.thumbnail_url)},Se=l=>{if(!l)return"";const e=l.split("/");return e[e.length-1]||l},$e=l=>{if(!l)return"";if(l.startsWith("/")){const e=window.location.origin+l;return console.log("视频预览URL:",e),e}return console.log("视频预览URL:",l),l},Ee=l=>{const e=l.target,i=e.src;console.error("视频加载失败:",{src:i,error:e.error,networkState:e.networkState,readyState:e.readyState});let r="视频加载失败";if(e.error)switch(e.error.code){case e.error.MEDIA_ERR_ABORTED:r="视频加载被中止";break;case e.error.MEDIA_ERR_NETWORK:r="网络错误，无法加载视频";break;case e.error.MEDIA_ERR_DECODE:r="视频解码失败";break;case e.error.MEDIA_ERR_SRC_NOT_SUPPORTED:r="视频格式不支持或文件不存在";break;default:r=`视频加载失败 (错误代码: ${e.error.code})`}d.error(r),console.error("视频URL:",i),console.error("请检查：1. 文件是否存在 2. 后端路由是否正确 3. 网络请求是否成功")},Te=l=>{console.log("视频开始加载:",l.target.src)},De=l=>{console.log("视频加载成功:",l.target.src),console.log("视频时长:",l.target.duration,"秒")},Le=()=>{a.value.video_url="",a.value.video_id=null},Me=l=>{const e=/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(l.name),i=l.size/1024/1024<5;return e?i?!0:(d.error("图片大小不能超过 5MB!"),!1):(d.error("只能上传图片文件!"),!1)},Re=l=>{if(console.log("封面图片上传响应:",l),l&&l.code===200){const e=l.data||l,i=e.url||e;console.log("存储的封面图片URL:",i),a.value.thumbnail_url=i,d.success("封面图片上传成功")}else console.error("封面图片上传失败，响应:",l),d.error((l==null?void 0:l.message)||(l==null?void 0:l.error)||"上传失败")},Pe=()=>{d.error("封面图片上传失败，请重试")},oe=l=>l?l.startsWith("/")?window.location.origin+l:l:"",Ne=()=>{d.warning("封面图片加载失败")},Be=()=>{a.value.thumbnail_url=""},He=l=>{const e=/\.(mp4|mov|avi|flv|wmv|webm)$/i.test(l.name),i=l.size/1024/1024<500;return e?i?!0:(d.error("视频大小不能超过 500MB!"),!1):(d.error("只能上传视频文件!"),!1)},Ie=l=>{if(console.log("上传响应:",l),l&&l.code===200){const e=l.data||l,i=e.url||e;if(console.log("存储的视频URL:",i),a.value.video_url=i,console.log("form.video_url 已设置为:",a.value.video_url),!a.value.video_title&&e.filename){const h=e.filename.replace(/\.(mp4|mov|avi|flv|wmv|webm|mkv)$/i,"").replace(/^\d{8}_\d{6}_/,"");h&&(a.value.video_title=h)}d.success("上传成功")}else console.error("上传失败，响应:",l),d.error((l==null?void 0:l.message)||(l==null?void 0:l.error)||"上传失败")},Oe=()=>{d.error("上传失败，请重试")},je=()=>{C.value==="immediate"&&(a.value.publish_date="")},qe=()=>{if(g.value===0){if(V.value==="upload"&&!a.value.video_url){d.warning("请上传视频文件");return}if(V.value==="library"&&!a.value.video_id){d.warning("请选择视频");return}}if(g.value===1&&(!a.value.account_ids||a.value.account_ids.length===0)){d.warning("请至少选择一个账号");return}if(g.value===2){if(!a.value.video_title||a.value.video_title.trim()===""){d.warning("请输入视频标题");return}if(a.value.video_title.length>100){d.warning("视频标题不能超过100个字符");return}if(a.value.video_description&&a.value.video_description.length>500){d.warning("视频描述不能超过500个字符");return}}g.value<3&&g.value++},We=()=>{g.value>0&&g.value--},Fe=async()=>{var l;if(!a.value.video_url&&!a.value.video_id){d.warning("请选择或输入视频");return}if(!a.value.account_ids||a.value.account_ids.length===0){d.warning("请至少选择一个账号");return}if(!a.value.video_title){d.warning("请输入视频标题");return}try{Y.value=!0;const e={video_id:a.value.video_id,video_url:a.value.video_url,video_title:a.value.video_title,video_description:a.value.video_description,video_tags:a.value.video_tags_array,thumbnail_url:a.value.thumbnail_url,account_ids:a.value.account_ids,publish_date:C.value==="scheduled"?a.value.publish_date:void 0,publish_type:C.value,publish_interval:C.value==="interval"?O.value:void 0,priority:a.value.priority,after_publish_actions:a.value.after_publish_actions,retry_on_failure:a.value.retry_on_failure,retry_count:a.value.retry_count},i=await W.post("/publish/submit",e);if(i.code===200){const r=((l=i.data)==null?void 0:l.total_tasks)||a.value.account_ids.length;d.success(`发布任务已创建，共 ${r} 个任务（${a.value.account_ids.length} 个账号）`),ne(),A.value||(A.value=!0),M()}else d.error(i.message||"发布失败")}catch(e){d.error(e.message||"发布失败"),console.error(e)}finally{Y.value=!1}},Ye=l=>{pe.alert(`<div style="text-align: left;">
      <p><strong>任务ID:</strong> ${l.id}</p>
      <p><strong>视频标题:</strong> ${l.video_title||"-"}</p>
      <p><strong>账号:</strong> ${l.account_name||"-"}</p>
      <p><strong>平台:</strong> ${L(l.platform)}</p>
      <p><strong>状态:</strong> ${te(l.status)}</p>
      <p><strong>进度:</strong> ${l.progress||0}%</p>
      <p><strong>创建时间:</strong> ${l.created_at?new Date(l.created_at).toLocaleString("zh-CN"):"-"}</p>
      <p><strong>开始时间:</strong> ${l.started_at?new Date(l.started_at).toLocaleString("zh-CN"):"-"}</p>
      <p><strong>完成时间:</strong> ${l.completed_at?new Date(l.completed_at).toLocaleString("zh-CN"):"-"}</p>
      ${l.error_message?`<p><strong>错误信息:</strong> <span style="color: #f56c6c;">${l.error_message}</span></p>`:""}
    </div>`,"任务详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"})},Ke=async l=>{try{await pe.confirm("确定要删除该任务吗？","提示",{type:"warning"});const e=await W.video.deleteTask(l.id);e.code===200?(d.success("删除成功"),M()):d.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(d.error(e.message||"删除失败"),console.error(e))}},ne=()=>{a.value={video_id:null,video_url:"",video_title:"",video_description:"",video_tags_array:[],thumbnail_url:"",account_ids:[],publish_date:"",priority:"normal",after_publish_actions:[],retry_on_failure:!1,retry_count:3},g.value=0,V.value="upload",z.value=[],C.value="immediate",O.value=30};return il(()=>{ye()}),(l,e)=>{const i=v("el-icon"),r=v("el-button"),h=v("el-table-column"),R=v("el-tag"),Ge=v("el-progress"),Je=v("el-table"),Qe=v("el-pagination"),Xe=v("el-collapse-transition"),j=v("el-step"),Ze=v("el-steps"),U=v("el-radio"),Q=v("el-radio-group"),ie=v("el-upload"),$=v("el-text"),f=v("el-form-item"),se=v("el-image"),X=v("el-option"),Z=v("el-select"),P=v("el-card"),T=v("el-checkbox"),re=v("el-checkbox-group"),ee=v("el-input"),el=v("el-date-picker"),ue=v("el-input-number"),ll=v("el-switch"),tl=v("el-form"),al=sl("loading");return u(),_("div",cl,[t(P,{shadow:"never"},{header:o(()=>[p("div",ml,[e[18]||(e[18]=p("h3",null,"立即发布",-1)),t(r,{type:"info",onClick:e[0]||(e[0]=n=>A.value=!A.value)},{default:o(()=>[t(i,null,{default:o(()=>[t(E(vl))]),_:1}),s(" "+m(A.value?"隐藏":"查看")+"发布历史 ",1)]),_:1})])]),default:o(()=>[t(Xe,null,{default:o(()=>[D(p("div",gl,[e[21]||(e[21]=p("h4",null,"最近发布记录",-1)),D((u(),b(Je,{data:ve.value,stripe:"",style:{width:"100%"}},{default:o(()=>[t(h,{prop:"video_title",label:"视频标题","min-width":"150"}),t(h,{prop:"account_name",label:"发布账号",width:"120"}),t(h,{prop:"platform",label:"平台",width:"100"},{default:o(({row:n})=>[s(m(L(n.platform)),1)]),_:1}),t(h,{prop:"status",label:"状态",width:"100"},{default:o(({row:n})=>[t(R,{type:ge(n.status)},{default:o(()=>[s(m(te(n.status)),1)]),_:2},1032,["type"])]),_:1}),t(h,{prop:"publish_time",label:"发布时间",width:"180"},{default:o(({row:n})=>[s(m(n.status==="completed"&&n.completed_at?new Date(n.completed_at).toLocaleString("zh-CN"):n.created_at?new Date(n.created_at).toLocaleString("zh-CN"):"-"),1)]),_:1}),t(h,{prop:"progress",label:"进度",width:"120"},{default:o(({row:n})=>[t(Ge,{percentage:n.progress||0,status:n.status==="failed"?"exception":n.status==="completed"?"success":"","stroke-width":8},null,8,["percentage","status"])]),_:1}),t(h,{prop:"error_message",label:"错误信息","min-width":"200","show-overflow-tooltip":""},{default:o(({row:n})=>[n.error_message?(u(),_("span",fl,m(n.error_message),1)):(u(),_("span",yl,"-"))]),_:1}),t(h,{label:"操作",width:"150"},{default:o(({row:n})=>[t(r,{link:"",type:"primary",size:"small",onClick:N=>Ye(n)},{default:o(()=>[...e[19]||(e[19]=[s("详情",-1)])]),_:1},8,["onClick"]),n.status==="pending"||n.status==="failed"?(u(),b(r,{key:0,link:"",type:"danger",size:"small",onClick:N=>Ke(n)},{default:o(()=>[...e[20]||(e[20]=[s("删除",-1)])]),_:1},8,["onClick"])):c("",!0)]),_:1})]),_:1},8,["data"])),[[al,K.value]]),p("div",bl,[t(Qe,{"current-page":w.value.page,"page-size":w.value.size,total:w.value.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:e[1]||(e[1]=n=>{w.value.size=n,M()}),onCurrentChange:e[2]||(e[2]=n=>{w.value.page=n,M()})},null,8,["current-page","page-size","total"])])],512),[[B,A.value]])]),_:1}),t(Ze,{active:g.value,"finish-status":"success",style:{margin:"30px 0"}},{default:o(()=>[t(j,{title:"选择视频"}),t(j,{title:"选择账号"}),t(j,{title:"编辑信息"}),t(j,{title:"发布设置"})]),_:1},8,["active"]),t(tl,{model:a.value,"label-width":"140px",style:{"max-width":"1000px",margin:"0 auto"}},{default:o(()=>[D(p("div",hl,[t(P,{shadow:"hover"},{header:o(()=>[...e[22]||(e[22]=[p("span",null,"选择视频",-1)])]),default:o(()=>[t(Q,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=n=>V.value=n),onChange:ze},{default:o(()=>[t(U,{label:"upload"},{default:o(()=>[...e[23]||(e[23]=[s("本地上传",-1)])]),_:1}),t(U,{label:"library"},{default:o(()=>[...e[24]||(e[24]=[s("从视频库选择",-1)])]),_:1})]),_:1},8,["modelValue"]),V.value==="upload"?(u(),_("div",xl,[t(f,{label:"上传视频",required:""},{default:o(()=>[t(ie,{class:"video-uploader",action:ce.value,headers:le.value,"on-success":Ie,"on-error":Oe,"before-upload":He,"show-file-list":!1,accept:"video/*"},{tip:o(()=>[...e[26]||(e[26]=[p("div",{class:"el-upload__tip"},"支持 mp4、mov、avi 格式，文件大小不超过 500MB",-1)])]),default:o(()=>[t(r,{type:"primary"},{default:o(()=>[t(i,null,{default:o(()=>[t(E(de))]),_:1}),e[25]||(e[25]=s(" 选择视频文件 ",-1))]),_:1})]),_:1},8,["action","headers"]),a.value.video_url?(u(),_("div",kl,[t($,{type:"success",size:"small"},{default:o(()=>[t(i,null,{default:o(()=>[t(E(rl))]),_:1}),s(" 已上传: "+m(Se(a.value.video_url)),1)]),_:1}),t(r,{link:"",type:"danger",size:"small",onClick:Le,style:{"margin-left":"10px"}},{default:o(()=>[...e[27]||(e[27]=[s(" 清除 ",-1)])]),_:1})])):c("",!0)]),_:1}),t(f,{label:"视频预览"},{default:o(()=>[p("div",wl,[a.value.video_url?(u(),_("video",{key:a.value.video_url,src:$e(a.value.video_url),controls:"",preload:"metadata",style:{"max-width":"100%","max-height":"300px"},onError:Ee,onLoadedmetadata:De,onLoadstart:Te}," 您的浏览器不支持视频播放 ",40,Vl)):(u(),_("div",Cl,[t(i,{size:"48"},{default:o(()=>[t(E(ul))]),_:1}),e[28]||(e[28]=p("p",null,"视频预览",-1))]))])]),_:1})])):c("",!0),V.value==="library"?(u(),_("div",Ul,[t(f,{label:"选择视频",required:""},{default:o(()=>[t(Z,{modelValue:a.value.video_id,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.video_id=n),placeholder:"请从视频库选择视频",filterable:"",style:{width:"100%"},onChange:Ae},{default:o(()=>[(u(!0),_(H,null,I(F.value,n=>(u(),b(X,{key:n.id,label:n.video_name||n.video_url,value:n.id},{default:o(()=>[p("div",zl,[n.thumbnail_url?(u(),b(se,{key:0,src:n.thumbnail_url,style:{width:"60px",height:"40px","margin-right":"10px","border-radius":"4px"},fit:"cover"},null,8,["src"])):c("",!0),p("span",null,m(n.video_name||n.video_url),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{type:"primary",link:"",onClick:ae},{default:o(()=>[...e[29]||(e[29]=[s("刷新视频库",-1)])]),_:1})])):c("",!0)]),_:1})],512),[[B,g.value===0]]),D(p("div",Al,[t(P,{shadow:"hover"},{header:o(()=>[...e[30]||(e[30]=[p("span",null,"选择发布账号",-1)])]),default:o(()=>[t(f,{label:"平台筛选"},{default:o(()=>[t(re,{modelValue:z.value,"onUpdate:modelValue":e[5]||(e[5]=n=>z.value=n),onChange:J},{default:o(()=>[t(T,{label:"douyin"},{default:o(()=>[e[31]||(e[31]=s(" 抖音 ",-1)),t($,{type:"info",size:"small",style:{"margin-left":"5px"}},{default:o(()=>[s(" ("+m(G("douyin"))+") ",1)]),_:1})]),_:1}),t(T,{label:"kuaishou"},{default:o(()=>[e[32]||(e[32]=s(" 快手 ",-1)),t($,{type:"info",size:"small",style:{"margin-left":"5px"}},{default:o(()=>[s(" ("+m(G("kuaishou"))+") ",1)]),_:1})]),_:1}),t(T,{label:"xiaohongshu"},{default:o(()=>[e[33]||(e[33]=s(" 小红书 ",-1)),t($,{type:"info",size:"small",style:{"margin-left":"5px"}},{default:o(()=>[s(" ("+m(G("xiaohongshu"))+") ",1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"选择账号",required:""},{default:o(()=>[p("div",Sl,[t($,{type:"info",size:"small"},{default:o(()=>[s(" 已选择 "+m(a.value.account_ids.length)+" 个账号 ",1),x.value.length>0?(u(),_("span",$l," / 当前筛选显示 "+m(x.value.length)+" 个账号 ",1)):c("",!0)]),_:1})]),t(Z,{modelValue:a.value.account_ids,"onUpdate:modelValue":e[6]||(e[6]=n=>a.value.account_ids=n),placeholder:"请选择发布账号（可多选）",multiple:"",filterable:"",style:{width:"100%"},"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":3,onChange:we},{default:o(()=>[(u(!0),_(H,null,I(x.value,n=>(u(),b(X,{key:n.id,label:`${n.account_name} (${L(n.platform)})`,value:n.id,disabled:n.login_status!=="logged_in"},{default:o(()=>[p("div",El,[p("div",Tl,[p("span",null,m(n.account_name),1),t(R,{size:"small",type:be(n.platform)},{default:o(()=>[s(m(L(n.platform)),1)]),_:2},1032,["type"])]),p("div",Dl,[n.login_status?(u(),b(R,{key:0,size:"small",type:n.login_status==="logged_in"?"success":"warning"},{default:o(()=>[s(m(n.login_status==="logged_in"?"已登录":"未登录"),1)]),_:2},1032,["type"])):c("",!0)])])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]),x.value.length===0?(u(),_("div",Ll,[t($,{type:"warning",size:"small"},{default:o(()=>[t(i,{style:{"margin-right":"5px"}},{default:o(()=>[t(E(dl))]),_:1}),e[34]||(e[34]=s(" 当前筛选条件下没有可用的账号 ",-1))]),_:1})])):c("",!0)]),_:1}),t(f,null,{default:o(()=>[t(r,{type:"primary",link:"",onClick:he,disabled:x.value.length===0},{default:o(()=>[s(" 全选当前平台 ("+m(x.value.length)+") ",1)]),_:1},8,["disabled"]),t(r,{link:"",onClick:xe,disabled:a.value.account_ids.length===0},{default:o(()=>[...e[35]||(e[35]=[s(" 清空选择 ",-1)])]),_:1},8,["disabled"]),z.value.length>0?(u(),b(r,{key:0,link:"",type:"info",onClick:ke},{default:o(()=>[...e[36]||(e[36]=[s(" 清除平台筛选 ",-1)])]),_:1})):c("",!0)]),_:1}),a.value.account_ids&&a.value.account_ids.length>0?(u(),_("div",Ml,[(u(!0),_(H,null,I(a.value.account_ids,n=>(u(),b(R,{key:n,closable:"",onClose:N=>Ve(n),style:{margin:"5px"}},{default:o(()=>[s(m(fe(n)),1)]),_:2},1032,["onClose"]))),128))])):c("",!0)]),_:1})],512),[[B,g.value===1]]),D(p("div",Rl,[t(P,{shadow:"hover"},{header:o(()=>[...e[37]||(e[37]=[p("span",null,"编辑视频信息",-1)])]),default:o(()=>[t(f,{label:"视频标题",required:""},{default:o(()=>[t(ee,{modelValue:a.value.video_title,"onUpdate:modelValue":e[7]||(e[7]=n=>a.value.video_title=n),placeholder:"请输入视频标题",maxlength:"100","show-word-limit":"",clearable:""},null,8,["modelValue"])]),_:1}),t(f,{label:"视频描述"},{default:o(()=>[t(ee,{modelValue:a.value.video_description,"onUpdate:modelValue":e[8]||(e[8]=n=>a.value.video_description=n),type:"textarea",rows:4,placeholder:"请输入视频描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(f,{label:"视频标签"},{default:o(()=>[t(Z,{modelValue:a.value.video_tags_array,"onUpdate:modelValue":e[9]||(e[9]=n=>a.value.video_tags_array=n),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择或输入标签（最多10个）",style:{width:"100%"},"max-collapse-tags":3,"collapse-tags":"","collapse-tags-tooltip":"",onChange:Ue},{default:o(()=>[(u(!0),_(H,null,I(_e.value,n=>(u(),b(X,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a.value.video_tags_array&&a.value.video_tags_array.length>0?(u(),_("div",Pl,[(u(!0),_(H,null,I(a.value.video_tags_array,(n,N)=>(u(),b(R,{key:N,closable:"",onClose:Fl=>Ce(N),style:{margin:"5px 5px 5px 0"}},{default:o(()=>[s(m(n),1)]),_:2},1032,["onClose"]))),128))])):c("",!0),a.value.video_tags_array&&a.value.video_tags_array.length>=10?(u(),_("div",Nl,[t($,{type:"warning",size:"small"},{default:o(()=>[...e[38]||(e[38]=[s("最多只能添加10个标签",-1)])]),_:1})])):c("",!0)]),_:1}),t(f,{label:"封面图片"},{default:o(()=>[p("div",Bl,[t(ie,{class:"thumbnail-uploader",action:me.value,headers:le.value,"on-success":Re,"on-error":Pe,"before-upload":Me,"show-file-list":!1,accept:"image/*"},{tip:o(()=>[...e[40]||(e[40]=[p("div",{class:"el-upload__tip"},"支持 jpg、png、gif 格式，文件大小不超过 5MB",-1)])]),default:o(()=>[t(r,{type:"primary"},{default:o(()=>[t(i,null,{default:o(()=>[t(E(de))]),_:1}),e[39]||(e[39]=s(" 上传封面图片 ",-1))]),_:1})]),_:1},8,["action","headers"]),t(ee,{modelValue:a.value.thumbnail_url,"onUpdate:modelValue":e[10]||(e[10]=n=>a.value.thumbnail_url=n),placeholder:"或输入封面图片URL",clearable:"",style:{"margin-top":"10px"}},null,8,["modelValue"]),a.value.thumbnail_url?(u(),_("div",Hl,[t(se,{src:oe(a.value.thumbnail_url),fit:"cover",style:{width:"200px",height:"120px","border-radius":"4px",cursor:"pointer"},"preview-src-list":[oe(a.value.thumbnail_url)],onError:Ne},null,8,["src","preview-src-list"]),t(r,{link:"",type:"danger",size:"small",onClick:Be,style:{"margin-left":"10px"}},{default:o(()=>[...e[41]||(e[41]=[s(" 清除 ",-1)])]),_:1})])):c("",!0)])]),_:1})]),_:1})],512),[[B,g.value===2]]),D(p("div",Il,[t(P,{shadow:"hover"},{header:o(()=>[...e[42]||(e[42]=[p("span",null,"发布设置",-1)])]),default:o(()=>[t(f,{label:"发布时间"},{default:o(()=>[t(Q,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=n=>C.value=n),onChange:je},{default:o(()=>[t(U,{label:"immediate"},{default:o(()=>[...e[43]||(e[43]=[s("立即发布",-1)])]),_:1}),t(U,{label:"scheduled"},{default:o(()=>[...e[44]||(e[44]=[s("定时发布",-1)])]),_:1}),t(U,{label:"interval"},{default:o(()=>[...e[45]||(e[45]=[s("间隔发布",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),C.value==="scheduled"?(u(),b(f,{key:0,label:"发布时间"},{default:o(()=>[t(el,{modelValue:a.value.publish_date,"onUpdate:modelValue":e[12]||(e[12]=n=>a.value.publish_date=n),type:"datetime",placeholder:"选择发布时间",style:{width:"100%"},"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})):c("",!0),C.value==="interval"?(u(),b(f,{key:1,label:"发布间隔"},{default:o(()=>[t(ue,{modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=n=>O.value=n),min:1,max:1440,step:1,style:{width:"200px"}},null,8,["modelValue"]),e[46]||(e[46]=p("span",{style:{"margin-left":"10px"}},"分钟",-1))]),_:1})):c("",!0),t(f,{label:"发布优先级"},{default:o(()=>[t(Q,{modelValue:a.value.priority,"onUpdate:modelValue":e[14]||(e[14]=n=>a.value.priority=n)},{default:o(()=>[t(U,{label:"high"},{default:o(()=>[...e[47]||(e[47]=[s("高",-1)])]),_:1}),t(U,{label:"normal"},{default:o(()=>[...e[48]||(e[48]=[s("普通",-1)])]),_:1}),t(U,{label:"low"},{default:o(()=>[...e[49]||(e[49]=[s("低",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"发布后操作"},{default:o(()=>[t(re,{modelValue:a.value.after_publish_actions,"onUpdate:modelValue":e[15]||(e[15]=n=>a.value.after_publish_actions=n)},{default:o(()=>[t(T,{label:"auto_comment"},{default:o(()=>[...e[50]||(e[50]=[s("自动评论",-1)])]),_:1}),t(T,{label:"auto_like"},{default:o(()=>[...e[51]||(e[51]=[s("自动点赞",-1)])]),_:1}),t(T,{label:"auto_share"},{default:o(()=>[...e[52]||(e[52]=[s("自动分享",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"失败重试"},{default:o(()=>[t(ll,{modelValue:a.value.retry_on_failure,"onUpdate:modelValue":e[16]||(e[16]=n=>a.value.retry_on_failure=n)},null,8,["modelValue"]),a.value.retry_on_failure?(u(),_("span",Ol,[e[53]||(e[53]=s(" 最多重试 ",-1)),t(ue,{modelValue:a.value.retry_count,"onUpdate:modelValue":e[17]||(e[17]=n=>a.value.retry_count=n),min:1,max:5,step:1,style:{width:"100px",margin:"0 5px"}},null,8,["modelValue"]),e[54]||(e[54]=s(" 次 ",-1))])):c("",!0)]),_:1})]),_:1})],512),[[B,g.value===3]]),p("div",jl,[g.value>0?(u(),b(r,{key:0,onClick:We},{default:o(()=>[...e[55]||(e[55]=[s("上一步",-1)])]),_:1})):c("",!0),g.value<3?(u(),b(r,{key:1,type:"primary",onClick:qe},{default:o(()=>[...e[56]||(e[56]=[s("下一步",-1)])]),_:1})):c("",!0),g.value===3?(u(),b(r,{key:2,type:"primary",onClick:Fe,loading:Y.value,size:"large"},{default:o(()=>[t(i,null,{default:o(()=>[t(E(pl))]),_:1}),e[57]||(e[57]=s(" 立即发布 ",-1))]),_:1},8,["loading"])):c("",!0),t(r,{onClick:ne},{default:o(()=>[...e[58]||(e[58]=[s("重置",-1)])]),_:1})])]),_:1},8,["model"])]),_:1})])}}},Gl=ol(ql,[["__scopeId","data-v-6929d57f"]]);export{Gl as default};
